<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>About Me - Caterpillar Clay</title>
    <link rel="icon" type="image/png" href="/favicon.png" id="favicon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nVivM.woff2" as="font" type="font/woff2" crossorigin>
    <script>
        fetch('/api/site').then(r=>r.json()).then(d=>{if(d.favicon)document.getElementById('favicon').href=d.favicon});
    </script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=block" rel="stylesheet">
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_test_Y2FyaW5nLWpheWJpcmQtODYuY2xlcmsuYWNjb3VudHMuZGV2JA" src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" type="text/javascript"></script>
    <style>
        :root{
            --bg-primary:#F8F8F8;
            --bg-secondary:#FFFFFF;
            --bg-card:#FFFFFF;
            --text-primary:#18191B;
            --text-secondary:#666666;
            --accent:#97BAD9;
            --accent-hover:#7BA3C9;
            --border:#E0E0E0;
        }
        @media(prefers-color-scheme:dark){
            :root{
                --bg-primary:#18191B;
                --bg-secondary:#1E2022;
                --bg-card:#252729;
                --text-primary:#F8F8F8;
                --text-secondary:#A0A0A0;
                --accent:#97BAD9;
                --accent-hover:#AECCE8;
                --border:#333537;
            }
        }
        *{margin:0;padding:0;box-sizing:border-box;image-rendering:pixelated}
        body{font-family:'Press Start 2P',cursive;background:var(--bg-primary);color:var(--text-primary);min-height:100vh}
        #caterpillar{position:fixed;pointer-events:none;z-index:9999;will-change:transform;left:0;top:0;contain:strict}
        .stars{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;contain:strict}
        .star{position:absolute;background:#97BAD9;opacity:0.4;contain:strict}
        .star.twinkle{animation:twinkle 2s ease-in-out infinite;will-change:opacity}
        @keyframes twinkle{0%,100%{opacity:0.2}50%{opacity:0.6}}
        nav{height:70px;padding:0 20px;display:flex;align-items:center}
        nav{height:60px;padding:0 12px;display:flex;align-items:center}
        [x-cloak]{display:none !important}
        @media(max-width:768px){
            .nav-title{font-size:10px !important}
        }
        .container{max-width:900px;margin:40px auto;padding:0 20px;position:relative;z-index:10}
        .card{background:var(--bg-card);border:2px solid var(--border);border-radius:12px;padding:40px}
        .artist-img{width:100%;max-width:400px;border-radius:12px;border:2px solid var(--border);margin-bottom:32px}
        .description{font-size:10px;line-height:2.2;color:var(--text-secondary)}
        [x-cloak]{display:none !important}
        .skeleton{background:linear-gradient(90deg,var(--border) 25%,var(--bg-secondary) 50%,var(--border) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:12px}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        .img-skeleton{width:100%;max-width:400px;height:400px;margin:0 auto 32px}
        .text-skeleton{height:120px;max-width:600px;margin:0 auto}
            </style>
</head>
<body x-data="artistPage()">
    <div class="stars" id="stars"></div>
    <canvas id="caterpillar" width="72" height="40"></canvas>

    <nav style="background:#97BAD9;position:relative;z-index:1001;height:60px;padding:0 12px">
        <div style="width:100%;max-width:900px;margin:auto;display:flex;justify-content:space-between;align-items:center;color:#fff;height:100%">
            <a href="/about.html" style="color:#fff;text-decoration:none;font-size:8px">ABOUT ME</a>
            <a href="/" class="nav-title" style="font-size:14px;color:#fff;text-decoration:none;text-align:center">CATERPILLAR CLAY</a>
            <a href="/" style="color:#fff;text-decoration:none;font-size:8px">CART (<span x-text="cartItemCount">0</span>)</a>
        </div>
    </nav>

    <div class="container">
        <div class="card" style="text-align:center">
            <h1 style="font-size:16px;margin-bottom:32px;color:#97BAD9">About Me</h1>

            <div class="skeleton img-skeleton" x-show="!artistInfo.image"></div>
            <img :src="artistInfo.image" alt="The Artist" class="artist-img" x-cloak x-show="artistInfo.image">

            <div class="skeleton text-skeleton" x-show="!artistInfo.description"></div>
            <div style="background:#97BAD9;border-radius:12px;padding:24px;max-width:600px;margin:0 auto" x-show="artistInfo.description" x-cloak>
                <p style="font-size:10px;line-height:2.2;color:#18191B" x-text="artistInfo.description"></p>
            </div>
        </div>
    </div>

    <script>
        function artistPage() {
            return {
                cart: [],
                user: null,
                showUserMenu: false,
                initializing: true,
                artistInfo: { image: '', description: '' },

                get cartItemCount() {
                    return this.cart.reduce((a, b) => a + (b.quantity || 1), 0);
                },

                async init() {
                    // Load cart from localStorage
                    const savedCart = localStorage.getItem('cart');
                    if (savedCart) {
                        try {
                            this.cart = JSON.parse(savedCart);
                        } catch(e) {
                            this.cart = [];
                        }
                    }
                    await this.loadArtistInfo();
                    await this.initClerk();
                    this.initializing = false;
                },

                async loadArtistInfo() {
                    try {
                        const res = await fetch('/api/artist');
                        this.artistInfo = await res.json();
                    } catch(e) {
                        console.error('Failed to load artist info:', e);
                        // Fallback to defaults
                        this.artistInfo = {
                            image: '/artist/Alex.webp',
                            description: ''
                        };
                    }
                },

                async initClerk() {
                    try {
                        await window.Clerk.load();
                        this.user = window.Clerk.user;
                        window.Clerk.addListener(({user}) => {
                            this.user = user;
                        });
                    } catch(e) {
                        console.log('Clerk not configured');
                    }
                },

                signIn() {
                    window.location.href = '/login.html?redirect=' + encodeURIComponent(window.location.pathname);
                },

                async signOut() {
                    if (window.Clerk) {
                        await window.Clerk.signOut();
                        this.user = null;
                        this.showUserMenu = false;
                    }
                }
            }
        }

        // Generate pixel stars
        (function generateStars(){
            const container=document.getElementById('stars');
            const sizes=[2,3,4,6,8];
            for(let i=0;i<60;i++){
                const star=document.createElement('div');
                star.className='star'+(Math.random()>0.8?' twinkle':'');
                const size=sizes[Math.floor(Math.random()*sizes.length)];
                star.style.width=size+'px';
                star.style.height=size+'px';
                star.style.left=Math.random()*100+'%';
                star.style.top=Math.random()*100+'%';
                star.style.animationDelay=Math.random()*2+'s';
                container.appendChild(star);
            }
        })();

    </script>
    <script src="/scripts/caterpillar.js"></script>
</body>
</html>
